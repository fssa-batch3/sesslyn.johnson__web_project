<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Details Page</title>
  <link rel="stylesheet" href="../../assets/css/order/order_details.css">
  <link rel="stylesheet" href="../../assets/css/profile/header.css">
  <link rel="stylesheet" href="../../assets/css/normalize.css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700," rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@300&family=Prompt:wght@200&family=Source+Sans+Pro:wght@300&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300&display=swap" rel="stylesheet">
</head>

</head>

<body>
  <main>
    <div>
      <div class="heading_page">
        <td>
          <img src="../../assets/images/home_page/bag_icon.png" class="page" id="page" alt="bag icon">
          <img class="dotted_line" src="../../assets/images/home_page/dotted-line-icon.png" alt="dotted_line">
        </td>
        <td>
          <img src="../../assets/images/home_page/truck_icon.png" class="page" id="page_2" alt="bag icon">
          <img class="dotted_line" src="../../assets/images/home_page/dotted-line-icon.png" alt="dotted_line">
        </td>
        <td>
          <img src="../../assets/images/home_page/card_icon.png" class="page" id="page_3" alt="bag icon">
        </td>
      </div>
      <div class="heading_page">
        <small class="page_new">Your Shipping</small>
        <small class="page_text">Delivery Address</small>
        <small class="page_text">Payment Method</small>
      </div>
    </div>

    <div class="top">
      <div class="top_container">
        <h2>Delivery Information</h2>
        <form role="form" onsubmit="place_order(event)">
          <div class="order-details">
            <div class="details">
              <div class="form_details">
                <label>Name</label>
                <input type="text" class="name" required="true" id="user_name" title="Only Alphabets are allowed."
                  pattern="[a-zA-Z]+" placeholder="Daniel">
              </div>

              <div class="form_details">
                <label class="mobile_no">Mobile Number</label>
                <input type="text" class="name" required="true" title="it should be 10 digit number" id="user_no"
                  pattern="[6-9]{1}[0-9]{9}" placeholder="9952393568">
              </div>
            </div>

            <div class="details">
              <div class="form_details">
                <label>E-mail</label>
                <input type="text" class="name" required="true" id="user_email"
                  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                  title="Must contain @ and only lower case is allowed." required="true"
                  placeholder="daniel05@gmail.com">
              </div>

              <div class="form_details">
                <label class="mobile_no">City</label>
                <input type="text" class="name" title="Only Alphabets and space is allowed" required="true"
                  id="user_city" placeholder="Chennai">
              </div>
            </div>

            <div class="details">
              <div class="form_details">
                <label>State</label>
                <input type="text" class="name" required="true" id="user_state"
                  title="Only Alphabets and space is allowed" placeholder="Tamil Nadu">
              </div>

              <div class="form_details" id="zip_no">
                <label>ZIP Code</label>
                <input type="text" class="name" required="true"
                  title="It should be a 6 digit number without spaces and first digit can not be zero"
                  pattern="[6]{1}[0-9]{4}[1-9]{1}" maxlength="6" min="600001" max="643253" id="user_code"
                  placeholder="600094">
              </div>

              <div class="form_details" id="country_no">
                <label class="country_no">Country</label>
                <input type="text" class="name" required="true" id="user_country"
                  title="Only Alphabets and space is allowed" placeholder="India">
              </div>

            </div>

            <div class="details">
              <div class="form_details">
                <label>Address</label>
                <input type="text" class="name" required="true" id="user_address"
                  title="Accepts Alphabets, number and special character and space too."
                  placeholder="12th Nehru street, Perungudi.">
              </div>
            </div>
          </div>
      </div>

      <div class="middle_container">
        <h2>Schedule Delivery</h2>
        <div class="order-details">
          <div class="details">
            <div class="form_details">
              <label>Dates</label>
              <input type="date" class="name" disabled required="true" id="user_dates">
            </div>

            <div class="form_details">
              <label class="notes">Notes</label>
              <input type="text" class="name" id="user_notes"
                title="Accepts Alphabets, number and special character and space too." placeholder="Type Your Note">
            </div>
          </div>
        </div>
      </div>

      <div class="bottom_container">
        <h2>Payment Method</h2>
        <div class="details_pay">
          <div class="pay_ment" id="payment_option">
            <div class="input_cash" id="cash_1">
              <input type="radio" id="net_bank" name="options" class="user_cash">
              <label class="payment_label">Net Banking </label>
              <br>
            </div>

            <div class="input_cash" id="cash_2">
              <input type="radio" id="cash_delivery" name="options" class="user_cash">
              <label class="payment_label">Cash on Delivery</label>
              <br>
            </div>

            <div class="input_cash" id="cash_2">
              <input type="radio" id="credit_cards" name="options" class="user_cash">
              <label class="payment_label">Credit / Debit cards</label>
              <br>
            </div>
          </div>
        </div>
      </div>

    </div>

    </div>
    <button class="btn_order" type="submit">Proceed</button>
    </div>
    </form>
  </main>
  <script>

    //Radio button
    const netBank = document.querySelector("#net_bank");
    netBank.addEventListener("change", () => {
      if (netBank.checked) {
        cashDelivery.checked = false;
        creditCards.checked = false;
        localStorage.setItem("user_delivery", "Net Banking");
      }
    });

    const cashDelivery = document.querySelector("#cash_delivery");
    cashDelivery.addEventListener("change", () => {
      if (cashDelivery.checked) {
        netBank.checked = false;
        creditCards.checked = false;
        localStorage.setItem("user_delivery", "Cash On Delivery");
      }
    });

    const creditCards = document.querySelector("#credit_cards");
    creditCards.addEventListener("change", () => {
      if (creditCards.checked) {
        cashDelivery.checked = false;
        netBank.checked = false;
        localStorage.setItem("user_delivery", "Credit / Debit cards");
      }
    });

    const deliveryMethod = localStorage.getItem("user_delivery");
    if (deliveryMethod === "Net Banking") {
      netBank.checked = true;
    }
    if (deliveryMethod === "Cash On Delivery") {
      cashDelivery.checked = true;
    }
    if (deliveryMethod === "Credit / Debit cards") {
      creditCards.checked = true;
    }

    //Order details from user
    const profile_id = JSON.parse(localStorage.getItem("profile_id"));
    const user_crud = JSON.parse(localStorage.getItem("user_crud"));

    function login_data(e) {
      return e.user_email === profile_id;
    }

    const user_data = user_crud.find(login_data);
    document.getElementById("user_name").value = user_data.user_name;
    document.getElementById("user_no").value = user_data.user_no;
    document.getElementById("user_email").value = user_data.user_email;
    document.getElementById("user_city").value = user_data.user_city;
    document.getElementById("user_state").value = user_data.user_state;
    document.getElementById("user_country").value = user_data.user_country;
    document.getElementById("user_address").value = user_data.user_address;
    document.getElementById("user_code").value = "";
    document.getElementById("user_notes").value = "";
    document.getElementById("user_dates").value = "";

    function place_order() {
      const user_data = {};
      const formFields = ["user_name", "user_email", "user_no", "user_city", "user_state", "user_country", "user_address", "user_code", "user_notes", "user_dates"];

      formFields.forEach((field) => {
        const value = document.getElementById(field).value.trim().split(/\s+/g).join(" ");
        user_data[field] = value;
      });

      let isValid = false;
      for (const radioButton of radioButtons) {
        if (radioButton.checked) {
          isValid = true;
          break;
        }
      }
      if (!isValid) {
        alert("Please select an option");
        return false;
      }


      // Validate
      if (user_data.user_address === "" || user_data.user_city === "" || user_data.user_state === "" || user_data.user_country === "") {
        alert("Write your information properly");
        return false;
      }

      // Phone number
      if (user_data.user_no.length !== 10) {
        alert("Enter your number properly");
        return false;
      }

      // Pincode
      if (user_data.user_code.length !== 6) {
        alert("Enter your ZIP code properly");
        return false;
      }

      const order_user = JSON.parse(localStorage.getItem("order_user")) || [];

      order_user.push(user_data);

      localStorage.setItem("order_user", JSON.stringify(order_user));
      console.log(localStorage.getItem("order_user"));
      location.href = "./order_summary.html";
      event.preventDefault();
    }

    // Delivery Date
    const d = new Date();
    d.setDate(d.getDate() + 7);

    const year = d.getFullYear();
    const month = `0${d.getMonth() + 1}`.slice(-2);
    const day = `0${d.getDate()}`.slice(-2);

    const formattedDate = `${year}-${month}-${day}`;

    document.querySelector("#user_dates").value = formattedDate;

  </script>
  <script src="../../assets/comments/header.js"></script>
</body>

</html>