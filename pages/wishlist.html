<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wishlist</title>
  <link rel="stylesheet" href="../assets/css/wishlist.css">
  <link rel="stylesheet" href="../assets/css/profile/header.css">
  <link rel="stylesheet" href="../assets/css/normalize.css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700," rel="stylesheet" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@300&family=Prompt:wght@200&family=Source+Sans+Pro:wght@300&display=swap"
    rel="stylesheet">
</head>

<body>

  <div class="top">
    <div class="left_corner">
      <div class="top_container">
        <img src="../assets/images/home_page/sess.jfif" class="profile_image" alt="profile image" />
        <div class="crown">
          <img src="../assets/images/home_page/crown.png" class="crown_icon" alt="crwon image" />
          <p class="crown_text">Learner</p>
          <button id="btn_upload"><a href="#">Edit</a></button>
        </div>
      </div>
      <div class="nav_account">
        <button class="nav_profile" id="nav_1"><a href="../pages/order/order.html">My Orders</a></button>
        <button class="nav_profile" id="nav_2"><a href="../pages/cart.html">My Trolley</a></button>
        <button class="nav_profile" id="nav_3"><a href="../pages/wishlist.html">My Wishlist</a></button>
        <button class="nav_profile" id="nav_4"><a href="../pages/about.html">My Queries</a></button>
        <button class="nav_profile" id="nav_5"><a href="../pages/profile/profile_new.html">My Account</a></button>
      </div>

    </div>


    <div class="right_corner">

      <div class="wish_heading">
        <h1>My Wishlist</h1>
        <p>View favourite products you've saved to your wishlist</p>
        <hr class="new1">
      </div>

      <div class="wish_product">
        <div class="contain">
        
          <!-- <div class="wish_details">
            <div class="product">
               <img src="../assets/images/Sofa/sofa_2.jpg" class="product_1"
                          alt="Compat camal brown sofa">
                <div class="product_delete">
                   <p class="product_name">Compat Camal Brown Sofa</p>
                   <img src="../assets/images/home_page/delete_icon.png" class="delete_icon" alt="Delete icon" />
                </div>
                <hr class="new2">
                  <p class="price">₹ 55,999</p>
               <button class="btn_primary"><a href="#">Add to Cart</a></button>
               </div>
            </div> -->

        </div>
      </div>

    </div>

  </div>
  <script>
    let wish_list = JSON.parse(localStorage.getItem("wish_list"));
        if (!wish_list) {
            wish_list = []; 
        }
        let profile_id = JSON.parse(localStorage.getItem("profile_id"));
        let product_crud = JSON.parse(localStorage.getItem("product_crud"));
       
        for (i = 0; i < wish_list.length; i++) {
            if (wish_list[i].user_id === profile_id) {
                let prod_data = product_crud.find(product => product.product_uuid === wish_list[i].product_id);
         
    
      const div_details = document.createElement("div");
      div_details.setAttribute("class", "wish_details");
      console.log(div_details)

      const div_product = document.createElement("div");
      div_product.setAttribute("class", "product");
      div_details.append(div_product);

      const img_details = document.createElement("img");
      img_details.setAttribute("alt", "Product");
      img_details.setAttribute("class", "product_1");
      img_details.setAttribute("src", prod_data.image_url);
      div_product.append(img_details);

     const div_delete = document.createElement("div");
      div_delete.setAttribute("class", "product_delete");
      div_product.append(div_delete);

      const p_paragraph = document.createElement("p");
      p_paragraph.setAttribute("class", "product_name");
      p_paragraph.innerHTML = prod_data.product_name;
      div_delete.append(p_paragraph);

      const img_delete = document.createElement("img");
      img_delete.setAttribute("alt", "Delete icon");
      img_delete.setAttribute("class", "delete_icon");
      img_delete.setAttribute("data-remove", prod_data.product_uuid);
      img_delete.setAttribute("src", "../assets/images/home_page/delete_icon.png");
      div_delete.append(img_delete);

      const hr = document.createElement('hr');
      hr.setAttribute("class", "new2");
      div_product.append(hr);

      const p_price = document.createElement("p");
      p_price.setAttribute("class", "price");
      p_price.innerHTML = "₹ " + prod_data.product_sell;
      div_product.append(p_price);

      const button_primary = document.createElement("button");
      button_primary.setAttribute("class", "btn_primary");
      button_primary.setAttribute("data-id",prod_data.product_uuid)
      button_primary.innerHTML = "Add to Cart";
      div_product.append(button_primary);

      document.querySelector("div.contain").append(div_details);
    }

  }

  document.querySelector(".btn_primary").addEventListener("click", function () {
            let id_cart = this.dataset.id;
            let product_price = document.querySelector(".price").innerHTML.replace("₹ ", "");
            let cart_list = JSON.parse(localStorage.getItem('cart_list')) || [];
            let product_name = document.querySelector(".product_name").innerHTML || [];
            let image_url = document.querySelector(".product_1").getAttribute("src");
            let profile_id = JSON.parse(localStorage.getItem('profile_id'));
            let exist = cart_list.length &&
                JSON.parse(localStorage.getItem('cart_list')).some(data =>
                    data.product_uuid == id_cart && data.profile_id === profile_id
                );

            if (cart_list.find(p => p.product_uuid === id_cart && p.userId === profile_id)) {
                alert('Sorry, the product is already added to the cart');
                return;
            }
            if (!profile_id) {
                alert("Log In");
                window.location.href = "./profile/login.html";
                return;
            }
            if (!exist) {
                cart_list.push({
                    "product_uuid": id_cart,
                    "product_name": product_name,
                    "image_url": image_url,
                    "product_price": product_price,
                    "userId": profile_id,
                    "product_quantity": 1
                });
                localStorage.setItem('cart_list', JSON.stringify(cart_list));
                alert('Product Added to the Cart');
                location.href = "./cart.html";
            }
        });

        // function remove(e, uniqueid) {
        //     if (!e || typeof uniqueid !== 'string') {
        //         return;
        //     }
        //     e.preventDefault();
        //     const whish_list = JSON.parse(localStorage.getItem('whish_list') || '[]');
        //     const uniqueID_user = JSON.parse(localStorage.getItem('uniqueID_user') || '');
        //     const index = whish_list.findIndex(
        //         item => item.product_id === uniqueid && item.buyer_id === uniqueID_user
        //     );
        //     if (index !== -1 && confirm('Are you sure you want to remove your product')) {
        //         whish_list.splice(index, 1);
        //         localStorage.setItem('whish_list', JSON.stringify(whish_list));
        //         window.location.reload();
        //     }
        // }

        // let products = document.querySelectorAll(".delete_icon")
        // products.forEach(function (check) {
        //     check.addEventListener("click", function () {
        //         let wishlist_id = this.dataset.remove;
        //         localStorage.setItem("wishlist_id", JSON.stringify(wishlist_id));
        //         console.log(wishlist_id);

        //         if (confirm("Are you sure to remove this product?")) {
        //             let id = JSON.parse(localStorage.getItem("wishlist_id"));
        //             let all_products = JSON.parse(localStorage.getItem("wish_list"));
        //             console.log(all_products);
        //             let pdts = all_products.find(e => e.product_uuid == wishlist_id && e.userId == user)
        //             console.log(pdts);
        //             let indexOfProduct = all_products.indexOf(pdts);
        //             all_products.splice(indexOfProduct, 1);
        //             console.log(indexOfProduct);
        //             localStorage.setItem("cart_list", JSON.stringify(all_products));
        //         }
        //         window.location.reload();
        //     });
        // });

  </script>
  <script src="../assets/comments/header.js"></script>
</body>

</html>