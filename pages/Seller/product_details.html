<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Product Details page</title>
    <link rel="stylesheet" href="../../assets/css/seller/product_details.css">
    <link rel="stylesheet" href="../../assets/css/seller/homepage.css">
    <link rel="stylesheet" href="../../assets/css/normalize.css">
    <link rel="stylesheet" href="../../assets/css/header and footer.css">

    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700," rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>

<body id="product-main">
    <header class="header" id="header-nav">
        <div>
            <a href="./Homepage.html">
                <img class="logo-image" src="../../assets/images/Main/casas-logo.png" alt="logo image" />
            </a>
        </div>
        <div class="inner" id="input">
            <button type="submit"><a href="./Register-seller.html">Login</a></button>
        </div>
        <div class="triple-bar" id="profile-icon">
            <a href="profile-seller.html"><img src="../../assets/images/Main/profile (1).png" alt="bar icon" /></a>
        </div>
        <div class="plus-icon">
            <a href="new-product.html"><i class="fa fa-plus"></i></a>
        </div>
    </header>


    <div class="contain">
       
    </div>
    <script>

        let div_top
        let div_container
        let a_tag
        let img_product
        let img_delete
        let h2_title
        let p_paragraph
        let button_primary
        let button_secondary


        let product_upload = JSON.parse(localStorage.getItem("product_crud"));
        let seller = JSON.parse(localStorage.getItem("seller_id"));

        //  <div class="down">
        div_top = document.createElement("div");
        div_top.setAttribute("class", "top_container");
        console.log(div_top)

        // let added_products = [];

        for (let j = 0; j < product_upload.length; j++) {
            if(product_upload[j].sellerId === seller){

             let productDetails_list =  product_upload.find(p => p.product_uuid === product_upload[j]["product_uuid"]);

            if(productDetails_list){
            //  <div class="down">
            div_container = document.createElement("div");
            div_container.setAttribute("class", "container");
            div_container.setAttribute("data-id", productDetails_list["product_uuid"])
            div_top.append(div_container);


            //<img/>
            img_product = document.createElement("img");
            img_product.setAttribute("alt", productDetails_list["product_name"] + " image");
            img_product.setAttribute("class", "main_image");
            img_product.setAttribute("src", productDetails_list["image_url"]);
            img_product.setAttribute("data-id", productDetails_list["product_uuid"]);

          let  img_id = img_product.getAttribute('data-id');
            img_product.addEventListener("click", (event) => {
                const product_description = img_id;
                window.location.href = `./Product-uploaded .html?product_id=${product_description}`;
            })


            div_container.append(img_product);

            //<img/>
            img_delete = document.createElement("img");
            img_delete.setAttribute("alt", "delete_icon");
            img_delete.setAttribute("class", "delete_icon");
            img_delete.setAttribute("src", "../../assets/images/Main/delete_icon.png");
            div_container.append(img_delete);


            //<h2></h2>
            h2_title = document.createElement("h2");
            h2_title.innerHTML = productDetails_list["product_name"];
            div_container.append(h2_title);

            //<p class="price"></p>
            p_paragraph = document.createElement("p");
            p_paragraph.innerHTML = "Rs."+ productDetails_list["product_sell"];
            div_container.append(p_paragraph);

            //<button class="btn"></button>
            button_primary = document.createElement("button");
            button_primary.setAttribute("class", "button_add");
            button_primary.setAttribute("data-uuid", productDetails_list["product_uuid"]);
            button_primary.innerHTML = "Add";
            div_container.append(button_primary);
        
            //<button class="btn"></button>
            button_secondary = document.createElement("button");
            button_secondary.setAttribute("class", "button_remove");
            button_secondary.setAttribute("data-uuid", productDetails_list["product_uuid"]);
            button_secondary.innerHTML = "Remove";
            div_container.append(button_secondary);

        }
    }
}
        document.querySelector("div.contain").append(div_top);

      
        const add = document.querySelectorAll('button.button_add');
        add.forEach(function (findId) {
         findId.addEventListener('click', function () {
        const id = this.dataset.uuid;
        let added_products = JSON.parse(localStorage.getItem('added_products')) || [];
        // console.log(id)

    
        let exist = added_products.length &&
            JSON.parse(localStorage.getItem('added_products')).some(data =>
            data == id);

        if(!exist){
            added_products.push(
                id
            )
            localStorage.setItem("added_products", JSON.stringify(added_products));
            alert("Product is added to the User page");
        }
        else{
            alert("Product is already added");
        }
      });
    });

    const remove = document.querySelectorAll("button.button_remove");
     remove.forEach(function (findId) {
        findId.addEventListener('click', function() {
            let parentBox = this.closest(".container");
            let id = parentBox.querySelector(".button_remove").getAttribute("data-uuid");

            let delete_ids = JSON.parse(localStorage.getItem('added_products')) || [];
            
            let exist = delete_ids.length &&
                    JSON.parse(localStorage.getItem('added_products')).some(data =>
                        data == id)

                if (exist) {
                    alert("This product is removed from the page")

                    let uuid = JSON.parse(localStorage.getItem("added_products"));

                    function find_data(e) {
                        return e === id;
                    }
                    let remove_id = uuid.find(find_data);
                    console.log(remove_id)
                    const indexOfUser = uuid.indexOf(remove_id);
                    uuid.splice(indexOfUser, 1);
                    localStorage.setItem('added_products', JSON.stringify(uuid));
                }
                else{
                    alert("This product is not added yet!")
                }
        });
     });
    </script>

</body>

</html>

