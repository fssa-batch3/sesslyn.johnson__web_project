<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Seller Update</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital@1&family=Noto+Serif+SC:wght@200;300;400&family=Open+Sans:wght@300;400;500&family=Shalimar&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../assets/css/seller/product_form.css">
    <link rel="stylesheet" href="../../assets/css/profile/header.css">
    <link rel="stylesheet" href="../../assets/css/normalize.css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700," rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body>

    <div class="wrapper">
        <div class="inner">
            <div class="image-holder">
                <img src="../../assets/images/home_page/online_shopping-removebg-preview.png" id="update_image"
                    alt="idea with the bulb">
            </div>
            <form>
                <h3>Start Selling</h3>
                <div class="form-group">
                    <input type="text" placeholder="Product Name" id="product_name"
                        title="Only Alphabets and space is allowed" required class="form-control">
                    <input type="text" placeholder="Brand Name" id="product_brand"
                        title="Only Alphabets and space is allowed" required class="form-control">
                </div>
                <div class="form-group">
                    <input type="text" placeholder="Product Description" id="product_description"
                        title="Only Alphabets, numbers and space is allowed" required class="form-control">
                </div>
                <div class="form-group">
                    <input type="text" placeholder="Image" id="image_url" title="https://.*" required
                        class="form-control">
                </div>
                <div class="form-group">
                    <input type="text" placeholder="Actual Price" id="product_real" title="Only numbers is allowed"
                        required pattern="[0-9]{5}" class="form-control">
                    <input type="text" placeholder="Discount" id="product_discount" title="Only 2 numbers is allowed"
                        required pattern="[0-9]{2}" class="form-control">
                </div>
                <div class="form-group">
                    <input type="text"  placeholder="Product Quantity" id="product_quantity"  required  title="Only 2 numbers is allowed" min="5" max="150" 
                    pattern="[1-9][0-9]{0,2}" class="form-control">
                    <select name="" id="product_category" class="form-control" required>
                        <option value="" disabled selected>Product Category</option>
                        <option value="Sofa">Sofa</option>
                        <option value="Space Saving Furniture">Space Saving Furniture</option>
                        <option value="Wallpaper">Wallpaper</option>
                        <option value="Wadrobe">Wadrobe</option>
                        <option value="Crockery Units">Crockery Units</option>
                        <option value="Chandelier">Chandelier</option>
                    </select>
                </div>

                <div class="form-group">
                    <input type="text" required placeholder="Warranty"
                        title="Only Alphabets, numbers and space is allowed" pattern="[a-zA-Z0-9!@#$$%^&*()_+:>?|\]+"
                        id="product_warranty" class="form-control">
                </div>
                <span>Note : Only numbers should be used to write prices (in Rs) and Discount should be in % </span>
                <div class="btn">
                    <button type="submit" class="submit-form">Submit</button>
                    <button type="submit" class="delete-form">Delete</button>
                </div>

            </form>
        </div>
    </div>

    <script>

        //Url params for product update
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const product_id = urlParams.get("product_id");

        const uid = JSON.parse(localStorage.getItem("product_uuid"));
        const product = JSON.parse(localStorage.getItem("product_crud"));
        console.log(uid);

        function find_data(e) {
            return e.product_uuid == uid;
        }

        let product_data = product.find(find_data);

        document.getElementById("image_url").value = product_data.image_url;
        document.getElementById("product_brand").value = product_data.product_brand;
        document.getElementById("product_name").value = product_data.product_name;
        document.getElementById("product_category").value = product_data.product_category;
        document.getElementById("product_real").value = product_data.product_real;
        document.getElementById("product_discount").value = product_data.product_discount;
        document.getElementById("product_quantity").value = product_data.product_quantity;
        document.getElementById("product_description").value = product_data.product_description;
        document.getElementById("product_warranty").value = product_data.product_warranty;

        const image_element = document.getElementById("update_image");
        image_element.setAttribute("src", product_data.image_url);

        //Update Function
        const update = document.querySelector("button.submit-form");
        update.addEventListener("click", upadate_product);
        function upadate_product() {
            event.preventDefault();
            const uid = JSON.parse(localStorage.getItem("product_uuid"));
            const product = JSON.parse(localStorage.getItem("product_crud"));
            function find_data(e) {
                return e.product_uuid == uid;
            }

            product_data = product.find(find_data);

            const edit_image = document.getElementById("image_url").value;
            const edit_name = document.getElementById("product_name").value.trim().split(/\s+/g).join(" ");
            const edit_brand = document.getElementById("product_brand").value.trim().split(/\s+/g).join(" ");
            const edit_category = document.getElementById("product_category").value;
            const edit_real = document.getElementById("product_real").value;
            const edit_discount = document.getElementById("product_discount").value;
            const edit_quantity = document.getElementById("product_quantity").value;
            const edit_description = document.getElementById("product_description").value.trim().split(/\s+/g).join(" ");
            const edit_warranty = document.getElementById("product_warranty").value.trim().split(/\s+/g).join(" ");

            let edit_sell;
            if (edit_discount == edit_discount) {
                edit_sell = edit_real - (edit_real * edit_discount) / 100;
                edit_sell = Math.round(edit_sell);
            } else {
                edit_sell = edit_real - edit_discount;
            }

          
            product_data.image_url = edit_image;
            product_data.product_name = edit_name;
            product_data.product_brand = edit_brand;
            product_data.product_category = edit_category;
            product_data.product_real = edit_real;
            product_data.product_sell = edit_sell;
            product_data.product_discount = edit_discount;
            product_data.product_quantity = edit_quantity;
            product_data.product_description = edit_description;
            product_data.product_warranty = edit_warranty;

              // Validate
              if (product_data.product_name === "" || product_data.product_brand === "" || product_data.image_url === "" || product_data.product_description === "" || product_data.product_warranty === "" || product_data.product_quantity === "") {
                alert("Please enter all the information");
                return false;
            }

            function validate() {
                if (
                    /^\s*$/g.test(product_name) ||
                    /^\s*$/g.test(product_warranty) ||
                    /^\s*$/g.test(product_brand)
                ) {
                    alert("Write your information properly");
                    reset();
                }
            }

            validate();

            localStorage.setItem("product_crud", JSON.stringify(product));
            alert("Product updated successfully");

            window.location.href = "../Seller/product_list.html";
        }

        //Delete product
        const del_product = document.querySelector("button.delete-form");
        del_product.addEventListener("click", delData);

        function delData() {
            if (confirm("Are you sure?")) {
                const unique_id = JSON.parse(localStorage.getItem("product_uuid"));
                const product = JSON.parse(localStorage.getItem("product_crud"));
                function find_data(e) {
                    return e.product_uuid == unique_id;
                }
                product_data = product.find(find_data);
                const indexOfUser = product.indexOf(product_data);

                product.splice(indexOfUser, 1);
                localStorage.setItem("product_crud", JSON.stringify(product));
                window.location.href = "./product_list.html";
            }
        }

    </script>
    <script src="../../assets/js/chatBot.js"></script>
    <script src="../../assets/comments/seller_header.js"></script>

</body>

</html>